<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Auto Parts Finder</title>

<style>
:root{font-family:system-ui,Arial,sans-serif}
body{margin:0;background:#f6f7fb;color:#111}
.wrap{max-width:980px;margin:24px auto;padding:0 14px}
.card{background:#fff;border-radius:14px;padding:18px;box-shadow:0 10px 25px rgba(0,0,0,.08)}
h1{margin:0 0 6px;font-size:22px}
.sub{margin:0 0 14px;color:#555;font-size:14px}
.bar{margin:12px 0}
button{padding:10px 16px;border-radius:10px;border:none;background:#111;color:#fff;font-size:14px;cursor:pointer}
.grid{display:grid;gap:12px}
@media(min-width:860px){.grid{grid-template-columns:repeat(4,1fr)}}
label{display:block;font-size:13px;margin-bottom:6px}
select,input{width:100%;padding:10px;border-radius:10px;border:1px solid #ccc}
small{font-size:12px;color:#666}
.action{grid-column:1/-1}
.reset{background:#eee;color:#111;margin-top:10px}
</style>
</head>

<body>
<div class="wrap">
<div class="card">

<h1>Auto Parts Finder</h1>
<div class="sub">Select Year → Make → Model. Add engine size if you know it. Then press Research.</div>

<div class="bar">
<button onclick="window.top.location.href=WP_HOME_URL">⬅ Back to Website</button>
<span id="status">Loading…</span>
</div>

<div class="grid">
<div>
<label>Year</label>
<select id="year"></select>
</div>

<div>
<label>Make</label>
<select id="make" disabled></select>
<small>Auto-loaded</small>
</div>

<div>
<label>Model</label>
<select id="model" disabled></select>
<small>Auto-loaded</small>
</div>

<div>
<label>Engine size</label>
<input id="engine" placeholder="2.4L, 3.5L, Hybrid, EV">
</div>

<div>
<label>Part</label>
<select id="part">
<option value="">Select part</option>
<option>Brake Pads</option>
<option>Control Arm</option>
<option>Alternator</option>
<option>Battery</option>
<option>Radiator</option>
<option>Starter</option>
<option>Wheel Bearing</option>
</select>
</div>

<div class="action">
<label>Extra notes</label>
<input id="notes" placeholder="front, rear, left, right, OEM">
</div>

<div class="action">
<button onclick="research()">Research</button>
<button class="reset" onclick="resetAll()">Reset</button>
</div>
</div>

</div>
</div>

<script>
/* SET YOUR WORDPRESS LINKS HERE */
const WP_HOME_URL   = "https://qayaautomotiveinc.wordpress.com/";
const WP_SEARCH_URL = "https://qayaautomotiveinc.wordpress.com/shop/";

/* ELEMENTS */
const yearEl=document.getElementById("year");
const makeEl=document.getElementById("make");
const modelEl=document.getElementById("model");
const statusEl=document.getElementById("status");

/* YEARS */
for(let y=2026;y>=2006;y--)yearEl.innerHTML+=`<option>${y}</option>`;

/* LOAD ALL MAKES (STABLE) */
async function loadMakes(){
  statusEl.textContent = "Loading vehicle makes…";

  // Vehicle types we WANT
  const allowedTypes = [
    "Passenger Car",
    "Multipurpose Passenger Vehicle (MPV)",
    "Truck",
    "Incomplete Vehicle"
  ];

  const r = await fetch("https://vpic.nhtsa.dot.gov/api/vehicles/GetAllMakes?format=json");
  const j = await r.json();

  // Filter to auto-related makes only
  const autoMakes = j.Results
    .filter(m =>
      m.VehicleTypes &&
      m.VehicleTypes.some(vt => allowedTypes.includes(vt.Name))
    )
    .map(m => m.Make_Name)
    .sort((a,b)=>a.localeCompare(b));

  statusEl.textContent = `Auto makes loaded (${autoMakes.length})`;
  return autoMakes;
}

/* LOAD MODELS */
async function loadModels(year,make){
 const r=await fetch(`https://vpic.nhtsa.dot.gov/api/vehicles/GetModelsForMakeYear/make/${make}/modelyear/${year}?format=json`);
 const j=await r.json();
 return j.Results.map(x=>x.Model_Name).sort();
}

/* EVENTS */
yearEl.onchange=async()=>{
 makeEl.disabled=true;modelEl.disabled=true;
 makeEl.innerHTML="<option>Loading…</option>";
 const m=await loadMakes();
 makeEl.innerHTML="<option value=''>Select make</option>"+m.map(x=>`<option>${x}</option>`).join("");
 makeEl.disabled=false;
 statusEl.textContent="Makes loaded";
};

makeEl.onchange=async()=>{
 modelEl.disabled=true;
 modelEl.innerHTML="<option>Loading…</option>";
 const models=await loadModels(yearEl.value,makeEl.value);
 modelEl.innerHTML="<option value=''>Select model</option>"+models.map(x=>`<option>${x}</option>`).join("");
 modelEl.disabled=false;
};

/* ACTIONS */
function research(){
 if(!yearEl.value||!makeEl.value||!modelEl.value){alert("Please select Year, Make, and Model");return;}
 const q=[document.getElementById("part").value,yearEl.value,makeEl.value,modelEl.value,document.getElementById("engine").value,document.getElementById("notes").value].filter(Boolean).join(" ");
 window.top.location.href=WP_SEARCH_URL+"?s="+encodeURIComponent(q)+"&post_type=product";
}

function resetAll(){
 location.reload();
}
</script>
</body>
</html>
